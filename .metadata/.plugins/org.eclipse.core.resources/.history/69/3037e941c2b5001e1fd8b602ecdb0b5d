console.log("comment js in~");
console.log(bnoVal);

document.getElementById('cmtPostBtn').addEventListener('click', ()=>{
    const cmtText = document.getElementById('cmtText');
    if(cmtText.value == null || cmtText.value == ''){
        alert('댓글을 입력해주세요.');
        cmtText.focus();
        return false;
    }else{
        let cmtData = {
            bno: bnoVal,
            writer: document.getElementById('cmtWriter').innerText,
            content: cmtText.value
        };
        console.log(cmtData);
        //서버에 비동기로 보내기
        postCommentToServer(cmtData).then(result =>{
            if(result == '1'){
                alert("댓글 등록 성공~!!");
                cmtText.value="";
            }
            //화면에 뿌리기
            spreadCommentList(cmtData.bno);
        })
    }
})

async function postCommentToServer(cmtData){
    try {
        const url = "/comment/post"
        const config = {
            method: "post",
            headers: {
                'content-type' : 'application/json; charset=utf-8';
            },
            body: JSON.stringify(cmtData)
        };
        const resp = await fetch(url, config);
        const result = await resp.text();
        return result;
    } catch (error) {
        console.log(error);
    }
}

async function getCommentListFromServer(bno, page){
    try {
        const resp = await fetch("/comment/"+bno+"/"+page);
        const result = await resp.json(); //commentList return
        return result;
    } catch (error) {
        console.log(error);
    }
}

function spreadCommentList(bno, page=1){
    getCommentListFromServer(bno, page).then(result => {
        console.log(result.cmtList);
        //댓글 모양대로 뿌리기
        if(result.cmtList.length > 0){
            const div = document.getElementById('cmtListArea');
            div.innerText = '';
            for(let cvo of result.cmtList){
                let div2 = `<h2 class="accordion-header">`;
                div2 += `<button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne" data-cno=${cvo.cno}>${cvo.cno} - ${cvo.writer} (${cvo.regDate})</button>`;
                div2 += `</h2>`;
                div2 += `<div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">`;
                div2 += `<div class="accordion-body">`;
                div2 += `<strong>${cvo.content}</strong>`;
                div2 += `</div></div>`;
                div.innerHTML += div2;
            }
        }else{
            let div2 = `<div class="mb-3">`;
            div2 += `comment List Empty`;
            div2 += `</div>`;
            div2.innerHTML = div
        }
    })
}